mkdir -p ~/docker-gui/9-virtual-desktops/Xephyr
cd ~/docker-gui/9-virtual-desktops/Xephyr



nano Dockerfile




FROM ubuntu:18.04

RUN apt-get update && DEBIAN_FRONTEND=noninteractive \
    apt-get install -y --no-install-recommends \
    xserver-xephyr && \
    rm -rf /var/lib/apt/lists/*

ENTRYPOINT ["Xephyr"]








docker build -t xephyr .







cd ~/docker-gui/9-virtual-desktops/Xephyr





nano xephyr.sh






#!/bin/bash

# The X11 DISPLAY number of the nested Xephyr X server.
# Accepts user input value or defaults to :1
NESTED_DISPLAY=${@:-:1}

# Adjust BIN to point to the helper script directory
BIN=$(cd $(dirname $0); echo ${PWD%docker-gui*})docker-gui/bin

# Source X11 and Docker helper logic
. $BIN/docker-xauth.sh
. $BIN/docker-command.sh

# Run the Xephyr container
$DOCKER_COMMAND run --rm \
    --ipc=host \
    -u $(id -u):$(id -g) \
    -v /etc/passwd:/etc/passwd:ro \
    $X11_FLAGS_RW \
    xephyr $NESTED_DISPLAY -resizeable -ac -reset -terminate 2> /dev/null









chmod +x xephyr.sh









mkdir -p ~/docker-gui/bin
cd ~/docker-gui/bin






nano docker-xauth.sh









#!/bin/bash

DOCKER_XAUTHORITY=/tmp/.docker.xauth

if [ ! -f $DOCKER_XAUTHORITY ]; then
    touch $DOCKER_XAUTHORITY
    xauth nlist $DISPLAY | sed -e 's/^..../ffff/' | xauth -f $DOCKER_XAUTHORITY nmerge -
fi

X11_FLAGS_RW="-e DISPLAY=$DISPLAY -v $DOCKER_XAUTHORITY:/root/.Xauthority:rw -v /tmp/.X11-unix:/tmp/.X11-unix:rw"






chmod +x docker-xauth.sh









nano docker-command.sh



#!/bin/bash

DOCKER_COMMAND="docker"





chmod +x docker-command.sh






cd ~/docker-gui/9-virtual-desktops/Xephyr



./xephyr.sh











