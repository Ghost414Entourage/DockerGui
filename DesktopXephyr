mkdir -p ~/docker-gui/9-virtual-desktops/Xephyr
cd ~/docker-gui/9-virtual-desktops/Xephyr



nano Dockerfile




FROM ubuntu:18.04

RUN apt-get update && DEBIAN_FRONTEND=noninteractive \
    apt-get install -y --no-install-recommends \
    xserver-xephyr && \
    rm -rf /var/lib/apt/lists/*

ENTRYPOINT ["Xephyr"]








docker build -t xephyr .







cd ~/docker-gui/9-virtual-desktops/Xephyr





nano xephyr.sh






#!/bin/bash

# The X11 DISPLAY number of the nested Xephyr X server.
# Accepts user input value or defaults to :1
NESTED_DISPLAY=${@:-:1}

# Adjust BIN to point to the helper script directory
BIN=$(cd $(dirname $0); echo ${PWD%docker-gui*})docker-gui/bin

# Source X11 and Docker helper logic
. $BIN/docker-xauth.sh
. $BIN/docker-command.sh

# Run the Xephyr container
$DOCKER_COMMAND run --rm \
    --ipc=host \
    -u $(id -u):$(id -g) \
    -v /etc/passwd:/etc/passwd:ro \
    $X11_FLAGS_RW \
    xephyr $NESTED_DISPLAY -resizeable -ac -reset -terminate 2> /dev/null









chmod +x xephyr.sh









mkdir -p ~/docker-gui/bin
cd ~/docker-gui/bin






nano docker-xauth.sh









#!/bin/bash

DOCKER_XAUTHORITY=/tmp/.docker.xauth

if [ ! -f $DOCKER_XAUTHORITY ]; then
    touch $DOCKER_XAUTHORITY
    xauth nlist $DISPLAY | sed -e 's/^..../ffff/' | xauth -f $DOCKER_XAUTHORITY nmerge -
fi

X11_FLAGS_RW="-e DISPLAY=$DISPLAY -v $DOCKER_XAUTHORITY:/root/.Xauthority:rw -v /tmp/.X11-unix:/tmp/.X11-unix:rw"






chmod +x docker-xauth.sh









nano docker-command.sh



#!/bin/bash

DOCKER_COMMAND="docker"





chmod +x docker-command.sh






cd ~/docker-gui/9-virtual-desktops/Xephyr



./xephyr.sh







mkdir -p ~/docker-gui/9-virtual-desktops/debian-buster-lxde
cd ~/docker-gui/9-virtual-desktops/debian-buster-lxde






nano Dockerfile





FROM debian:buster

ENV LANG=en_GB.UTF-8
ENV TZ=Europe/London

RUN \
  apt-get update && \
  DEBIAN_FRONTEND=noninteractive \
  apt-get -fy -o Dpkg::Options::="--force-confnew" \
    -o APT::Immediate-Configure=false \
    dist-upgrade && \
  DEBIAN_FRONTEND=noninteractive \
  apt-get install -y --no-install-recommends \
    base-files vim ntp locales apt-transport-https curl \
    lxde lxde-settings-daemon lxlock lxmusic desktop-base \
    synaptic libnss-mdns thunderbird inkscape pidgin \
    gimp gimp-help-en transmission-gtk tracker-miner-fs \
    avahi-utils avahi-discover firefox-esr-l10n-en-gb \
    vlc mesa-utils thunderbird-l10n-en-gb libpam-kwallet4 \
    remmina remmina-common remmina-plugin-rdp \
    remmina-plugin-vnc remmina-plugin-nx libpam-kwallet5 \
    remmina-plugin-spice remmina-plugin-xdmcp sudo \
    geany libcanberra-pulse pulseaudio-module-bluetooth paprefs \
    pavucontrol gstreamer1.0-pulseaudio cups-pk-helper \
    pulseaudio-module-zeroconf cups system-config-printer \
    lightdm slick-greeter dbus-x11 && \
  rm /etc/apt/apt.conf.d/docker-gzip-indexes && \
  rm -rf /var/lib/apt/lists/* && apt-get update && \
  sed -i "s/^# *\($LANG\)/\1/" /etc/locale.gen && \
  locale-gen && \
  echo $TZ > /etc/timezone && \
  ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && \
  DEBIAN_FRONTEND=noninteractive dpkg-reconfigure tzdata && \
  rm /usr/share/xsessions/lightdm-xsession.desktop && \
  rm /usr/share/xsessions/openbox.desktop && \
  echo '#!/bin/bash\nexport XAUTHORITY=/root/.Xauthority.docker\nexport DISPLAY=:0\nexec Xephyr $1 -ac -dpi 48 >> /var/log/lightdm/x-1.log' > /usr/bin/Xephyr-lightdm-wrapper && \
  chmod +x /usr/bin/Xephyr-lightdm-wrapper && \
  echo '[LightDM]\nminimum-display-number=1\n[Seat:*]\nsession-setup-script=sh -c "xdpyinfo | grep -q RANDR && exec xrandr --output default --mode 1600x1200 || true"\ngreeter-hide-users=false\nxserver-command=/usr/bin/Xephyr-lightdm-wrapper' > /etc/lightdm/lightdm.conf && \
  rm -f /etc/systemd/system/display-manager.service && \
  ln -s /lib/systemd/system/lightdm.service /etc/systemd/system/display-manager.service && \
  echo '/usr/sbin/lightdm' > /etc/X11/default-display-manager && \
  echo '[Greeter]\nbackground=/usr/share/desktop-base/futureprototype-theme/plymouth/plymouth_background_future.png\n' > /etc/lightdm/slick-greeter.conf && \
  echo 'XKBMODEL="pc105"\nXKBLAYOUT="gb"\nXKBVARIANT=""\nXKBOPTIONS=""' > /etc/default/keyboard && \
  echo "console-setup console-setup/charmap select UTF-8" | debconf-set-selections && \
  sed -i 's/Dir::Cache::pkgcache "";//' /etc/apt/apt.conf.d/docker-clean && \
  rm -f /etc/systemd/system/getty.target.wants/getty@tty1.service && \
  sed -i 's/#DefaultTimeoutStopSec=90s/DefaultTimeoutStopSec=5s/' /etc/systemd/system.conf && \
  chmod 755 /etc/polkit-1/localauthority && \
  echo "[Shutdown & Restart]\nIdentity=unix-user:*\nAction=org.freedesktop.login1.power-off;org.freedesktop.login1.power-off-multiple-sessions;org.freedesktop.login1.reboot;org.freedesktop.login1.reboot-multiple-sessions\nResultAny=yes\nResultInactive=yes\nResultActive=yes\n" > /etc/polkit-1/localauthority/50-local.d/10-shutdown.pkla




docker build -t debian-lxde:buster .



















